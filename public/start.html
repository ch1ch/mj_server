<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>start</title>
  <style>
    #msglog, #messageInput {
      border: 1px solid #ccc;
      width: 500px;
      height: 350px;
      overflow-y: auto;
      font-size: 14px;
    }
    #messageInput {
      height: 80px;
    }
    .message {
      line-height: 22px;
    }
    .message .user {
      padding-right: 5px;
      padding-left: 5px;
      color: brown;
    }
    .sysMsg {
      color: #c1bfbf;
      padding-right: 5px;
      padding-left: 5px;
      font-size: 12px;
    }
    #users {
      width: 490px;
      padding: 0 5px 5px;
    }
    #startbtn{
      text-align: center;
      position: relative;
      /* top: 30%; */
      margin: 30%;
    }
  </style>
</head>
<body>
  昵称: <span id="userName"></span> <br/>

  <button id="startbtn">查询</button>
  <button id="joinroombtn">加入房间</button>
  <button id="creatroombtn">创建房间</button>
  <script src="/socket.io/socket.io.js"></script>
 <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
    $(function () {
        var openid='12345';
      $('#startbtn').click(function(event) {
        var id='12345';
        var name="张三";
        var ico='img/head.jpg';
        var tuijian='888';
        var time=Date.now();
        $.ajax({
          type: "get",
          method: "GET",
          data: {id:id},
          dataType: "json",
          url: "http://localhost:3010/api/getuser.api",
          beforeSend: function(XMLHttpRequest){

          },
          success: function(data, textStatus){
            console.log(data);
            if (data.code==1) {
              console.log('have');
            }else{
              console.log('not');
              adduser(openid,name,ico,tuijian,time);
            };
          },
          complete: function(XMLHttpRequest, textStatus){
          //  console.log(XMLHttpRequest);
          },
          error: function(err){
            console.log(err);
            //请求出错处理
          }   
        }); 

      });

      //$("#startbtn").trigger("click");

      function adduser(openid,name,ico,tuijian,time){
        var openid=Math.random().toString(36).substring(7);
        $.ajax({
          type: "post",
          method: "POST",
          data: {openid:openid,name:name,ico:ico,tuijian:tuijian,time:time},
          dataType: "json",
          url: "http://localhost:3010/api/adduser.api",
          beforeSend: function(XMLHttpRequest){

          },
          success: function(data, textStatus){
            console.log(data);
          },
          complete: function(XMLHttpRequest, textStatus){
          //  console.log(XMLHttpRequest);
          },
          error: function(err){
            console.log(err);
            //请求出错处理
          }   
        });   
      }

      $('#joinroombtn').click(function(event) {
        var id='35503';
        var time=Date.now();
        $.ajax({
          type: "get",
          method: "GET",
          data: {id:id,time:time},
          dataType: "json",
          url: "http://localhost:3010/api/joinroom.api",
          beforeSend: function(XMLHttpRequest){

          },
          success: function(data, textStatus){
            console.log(data);
            if (data.code==1) {
              console.log('have');
            }else{
              console.log('not');
             
            };
          },
          complete: function(XMLHttpRequest, textStatus){
          //  console.log(XMLHttpRequest);
          },
          error: function(err){
            console.log(err);
            //请求出错处理
          }   
        });         

      });

           
      $('#creatroombtn').click(function(event) {
        var time=Date.now();
        var gametype=1;
        var rule='123';
        $.ajax({
          type: "post",
          method: "POST",
          data: {time:time,hoster:openid,gametype:gametype,rule:rule},
          dataType: "json",
          url: "http://localhost:3010/api/addroom.api",
          beforeSend: function(XMLHttpRequest){

          },
          success: function(data, textStatus){
            console.log(data);
          },
          complete: function(XMLHttpRequest, textStatus){
          //  console.log(XMLHttpRequest);
          },
          error: function(err){
            console.log(err);
            //请求出错处理
          }   
        });           
      });

      $("#creatroombtn").trigger("click"); 

    });
  </script>
</body>
</html>